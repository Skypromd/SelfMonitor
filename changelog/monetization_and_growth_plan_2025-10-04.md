# План развития продукта и монетизации
**Дата анализа:** 2025-10-04

## 1. Текущий статус проекта (End of Prototype Phase)

На данный момент завершена разработка полнофункционального архитектурного прототипа. Система включает в себя:
- **Технологический фундамент:** Микросервисная архитектура на Python/FastAPI, фронтенд на Next.js/TypeScript, база данных PostgreSQL, очередь задач Celery/Redis, система мониторинга Prometheus/Grafana.
- **Реализованный функционал (MVP+):**
    - Регистрация, аутентификация, управление профилем.
    - Подключение банковских счетов (имитация Open Banking).
    - Автоматический импорт и ручная категоризация транзакций.
    - Прототип ML-категоризации на основе правил.
    - Загрузка и хранение документов в облаке (имитация S3).
    - Прототип асинхронного OCR.
    - Расчёт налогов для UK и имитация подачи в HMRC.
    - Работа с партнёрами (просмотр и "передача" пользователя).
    - Интернационализация (i18n) и администрирование пользователей.

## 2. Стратегические направления для развития продукта

Для перехода от прототипа к коммерчески успешному продукту предлагаются три ключевых направления, нацеленных на повышение ценности для конечного пользователя.

### Направление 1: Углублённый анализ данных с помощью ИИ
- **Цель:** Превратить приложение из инструмента учёта в персонального финансового советника.
- **Задачи:**
    - **Cash Flow Forecasting:** Реализовать в `analytics-service` ML-модель (например, на базе `Prophet`) для прогнозирования остатка на счетах.
    - **Anomaly Detection:** Внедрить алгоритмы для поиска аномалий в тратах (например, резкий рост расходов в категории "подписки").
    - **"Умные" подсказки:** Находить потенциально неклассифицированные бизнес-расходы и предлагать пользователю их учесть для снижения налога.

### Направление 2: Помощь в получении ипотеки
- **Цель:** Решить одну из самых больших и стрессовых задач для самозанятого.
- **Задачи:**
    - **Автоматический отчёт о доходах:** Создать в `analytics-service` функцию, генерирующую PDF-отчёт, который подтверждает стабильность дохода за последние 1-2 года.
    - **Интеграция с ипотечными брокерами:** Расширить `partner-registry`, позволив пользователям в один клик отправлять свой отчёт о доходах проверенным брокерам.

### Направление 3: Интеграция страховых продуктов
- **Цель:** Предлагать релевантные страховые продукты, закрывая потребности самозанятых, у которых нет корпоративных страховок.
- **Задачи:**
    - **Анализ потребностей:** `advice-service` на основе уровня дохода может генерировать рекомендации по страхованию жизни и дохода.
    - **Партнёрский Marketplace:** На странице `/partners` создать раздел "Страхование" со списком страховых брокеров.

## 3. Модели монетизации

### Модель А: Freemium + SaaS подписка
- **Free (Бесплатный):** Базовый функционал для привлечения аудитории (1 банковский счёт, ручная категоризация, оценка налогов).
- **Pro (£10-£15 / мес.):** Расширенный функционал для активных пользователей (неограниченно счетов, ML-категоризация, Cash Flow, подача в HMRC).

### Модель Б: Marketplace / Партнёрская программа
- **Pay-Per-Lead:** Фиксированная плата от партнёров (брокеров, консультантов) за каждый переданный им контакт ("лид").
- **Revenue Share:** Процент от успешной сделки партнёра, заключённой с нашим пользователем (требует более глубокой интеграции).

### Модель В: Разовые платные услуги (Pay-per-feature)
- Продажа отдельных, ценных, но разовых функций. Например, генерация отчёта для ипотеки за £25.

## 4. Рекомендуемая стратегия

**Комбинированный подход:**
1.  **Основа — Модель А (SaaS).** Это создаёт стабильный и прогнозируемый денежный поток (MRR). Главной "морковкой" для перехода на Pro-тариф будет **автоматическая ML-категоризация** и **прямая подача декларации в HMRC**.
2.  **Дополнительный доход — Модель Б (Marketplace).** Начать с простой модели **Pay-Per-Lead** для ипотечных и страховых брокеров. Это не требует сложной интеграции и сразу начинает приносить доход.

Эта стратегия позволяет диверсифицировать источники дохода и предложить ценность как бесплатным, так и платным пользователям.

---
## Начало реализации плана развития

### 1. Прототип AI-аналитики: Прогнозирование денежного потока (Backend)
- **Что это:** В `analytics-service` добавлена новая функция для прогнозирования движения денежных средств (cash flow).
- **Как это работает:**
    1. Создан новый эндпоинт `/forecast/cash-flow`.
    2. При вызове он обращается к `transactions-service` и забирает всю историю транзакций пользователя.
    3. На основе этих данных применяется простая модель прогнозирования (расчёт среднего ежедневного прироста/убытка баланса).
    4. Сервис возвращает спроецированный баланс на каждый день на 30 дней вперёд.
- **Цель:** Реализовать бэкенд для первой функции из направления "Анализ через ИИ". Это создаёт основу для визуализации прогнозов на фронтенде и является первым шагом к созданию "финансового помощника".

### 2. Визуализация прогноза на фронтенде
- **Что это:** На главную страницу дашборда (`/dashboard`) добавлен новый компонент.
- **Как это работает:**
    1. При загрузке дашборда фронтенд обращается к эндпоинту `/forecast/cash-flow` в `analytics-service`.
    2. Полученные данные о прогнозируемом балансе на 30 дней вперёд отображаются в виде наглядного линейного графика с помощью библиотеки **Recharts**.
- **Цель:** Предоставить пользователю ценный и легко читаемый инсайт о будущем состоянии его финансов, тем самым реализовав полный сквозной сценарий для функции прогнозирования.

### 3. Генерация отчёта для ипотеки (Backend)
- **Что это:** В `analytics-service` добавлена функция для автоматической генерации "Отчёта о готовности к ипотеке".
- **Как это работает:**
    1. Создан новый эндпоинт `/reports/mortgage-readiness`.
    2. При вызове он анализирует все доходы пользователя за последние 12 месяцев, рассчитывает общий и среднемесячный доход.
    3. С помощью библиотеки `fpdf2` "на лету" создаётся PDF-документ, содержащий эту сводную информацию в удобном для банка или брокера виде.
    4. Эндпоинт возвращает готовый PDF-файл для скачивания.
- **Цель:** Реализовать бэкенд для функции, которая решает одну из самых болезненных проблем самозанятых. Это открывает возможности для монетизации по модели "Pay-per-feature" (плата за отчёт) или для более глубокой интеграции с партнёрами-брокерами.

### 4. Визуализация отчёта на фронтенде
- **Что это:** Создана новая страница `/reports`, на которой пользователь может сгенерировать и скачать свой "Отчёт о готовности к ипотеке".
- **Как это работает:**
    1. При нажатии кнопки "Generate Report" фронтенд делает запрос к бэкенду.
    2. JavaScript в браузере получает ответ в виде бинарного `blob` (PDF-файл).
    3. Программно создаётся ссылка на этот `blob`, и инициируется скачивание файла на компьютер пользователя.
- **Цель:** Завершить полный цикл реализации функции. Пользователь теперь может не только запустить сложный аналитический процесс на бэкенде, но и получить его результат в виде готового, полезного документа.

### 5. Создание централизованного Marketplace для партнёрских услуг
- **Что это:** Проведена архитектурная реорганизация фронтенда для создания единого центра партнёрских услуг.
- **Как это работает:**
    1. Создана новая страница `/marketplace`, которая запрашивает *всех* партнёров из `partner-registry` и группирует их по типу услуг (бухгалтерия, страхование, ипотека).
    2. Дашборд был изменён: вместо специфичного блока про страхование теперь на нём отображается более общий **"Центр действий"**, который даёт пользователю полезный совет и предлагает перейти в маркетплейс для поиска решения.
    3. Старая страница `/partners` была удалена за ненадобностью.
- **Цель:** Создать масштабируемую платформу для монетизации по модели "Marketplace". Теперь добавление нового типа партнёрской услуги (например, "Юридические консультации") не потребует изменения UI дашборда, а сведётся к добавлению партнёра на бэкенде — он автоматически появится в нужной категории маркетплейса.

## Улучшение надёжности: Интеграционное тестирование

- **Что это:** Внедрён новый, верхнеуровневый слой тестирования — **интеграционные тесты**.
- **Как это работает:**
    1. Создана новая директория `/tests` в корне проекта, независимая от юнит-тестов отдельных сервисов.
    2. Написан первый интеграционный тест, который проверяет полный сценарий жизненного цикла пользователя: регистрация в `auth-service`, получение токена, создание и проверка профиля в `user-profile-service`.
    3. В отличие от юнит-тестов, этот тест не использует "моки" или имитации. Он делает **реальные HTTP-запросы** к сервисам, запущенным в Docker, и проверяет, что вся цепочка (сервис А -> сервис Б -> База данных) работает корректно.
- **Цель:** Повысить уверенность в работоспособности системы как единого целого. Эти тесты позволяют отлавливать проблемы, которые невозможно обнаружить на уровне юнит-тестирования, например, ошибки в сетевых настройках, конфигурации Docker или реальном взаимодействии API.

## Финальный штрих: Завершение стека Observability

### 1. Внедрение распределённой трассировки (OpenTelemetry + Jaeger)
- **Что это:** Внедрён третий, самый продвинутый "столп наблюдаемости" — распределённая трассировка.
- **Технология:**
    - В архитектуру добавлен **Jaeger** — система для сбора и визуализации трейсов.
    - Ключевые сервисы (`tax-engine`, `transactions-service`) были инструментированы с помощью **OpenTelemetry**. Теперь каждый входящий и исходящий из них запрос помечается уникальным `trace_id`.
    - Все "спаны" (операции внутри сервиса) и их длительность отправляются в Jaeger.
- **Цель:** Получить полную "прозрачность" системы. Теперь мы можем отследить путь **одного** запроса через всю нашу сложную микросервисную архитектуру. Если запрос работает медленно, мы увидим в Jaeger детальный "водопад" вызовов и сможем мгновенно определить, какой именно сервис или какая операция в нём (например, запрос к базе данных) является узким местом. Это завершает создание нашего "центра управления полетами".

### 2. Тестирование асинхронных сценариев
- **Что это:** Написан второй, более сложный интеграционный тест.
- **Как это работает:**
    - Тест проверяет **полный асинхронный сценарий** импорта транзакций:
        1. Вызывает `banking-connector` для имитации подключения к банку.
        2. `banking-connector` отправляет задачу в **Redis**.
        3. Тест делает паузу, ожидая, пока `celery-worker` заберёт и выполнит задачу.
        4. `celery-worker` вызывает `transactions-service`, который, в свою очередь, обращается к `categorization-service`.
        5. Тест делает финальный запрос к `transactions-service` и проверяет, что транзакции не просто сохранились в **PostgreSQL**, а сохранились уже с **правильной, автоматически присвоенной категорией**.
- **Цель:** Доказать, что вся наша сложная распределённая система (веб-сервис, очередь сообщений, воркер, база данных, другой веб-сервис) работает как единый, слаженный механизм. Это самый высокий уровень тестов, подтверждающий надёжность архитектуры.

## Финальный штрих: Безопасность промышленного уровня

### 1. Внедрение хранилища секретов (HashiCorp Vault)
- **Что это:** Реализован самый безопасный подход к управлению секретами.
- **Технология:**
    - В архитектуру добавлен **HashiCorp Vault** — золотой стандарт для хранения секретных данных (API-ключей, токенов, паролей).
    - `banking-connector` был переработан. Теперь, при получении токенов доступа от банка, он не хранит их в своей базе данных, а **сохраняет их в зашифрованном виде в Vault**.
- **Цель:** Обеспечить максимальный уровень безопасности для самых чувствительных данных — ключей доступа к финансам пользователей. Даже в случае компрометации основной базы данных, злоумышленники не получат доступа к этим секретам. Это является фундаментальным требованием для прохождения любых сертификаций безопасности (SOC2, ISO 27001) и построения доверия с клиентами. **Этот шаг завершает формирование эталонной, production-ready архитектуры.**

## Финальный штрих: Завершение стека Observability

### 1. Централизованный сбор логов (Loki + Promtail)
- **Что это:** Внедрена система для агрегации логов со всех микросервисов в одном месте.
- **Технология:**
    - В `docker-compose.yml` добавлены **Loki** (база данных для логов) и **Promtail** (агент для сбора логов).
    - Promtail настроен так, чтобы автоматически обнаруживать все запущенные Docker-контейнеры и собирать их стандартный вывод (логи).
    - **Grafana** была настроена на использование Loki в качестве второго источника данных.
- **Цель:** Завершить создание "трёх столпов наблюдаемости" (metrics, logs, traces). Теперь в Grafana можно не только смотреть на графики производительности (Prometheus), но и на соседней вкладке искать и анализировать текстовые логи от **любого** из наших 17 сервисов, коррелируя их с метриками. Это превращает отладку в распределённой системе из кошмара в управляемый процесс.

## Финальное улучшение: Проактивный Ассистент

### 1. Создание `calendar-service`
- **Что это:** Добавлен новый микросервис, который имитирует создание событий в календаре пользователя.
- **Как это работает:**
    1. После того как `tax-engine` успешно "подаёт" декларацию в HMRC, он делает дополнительный шаг.
    2. Он обращается к новому `calendar-service` и просит его создать событие "Крайний срок уплаты налога" на 31 января следующего года, добавив в описание сумму налога.
    3. Пользователь на фронтенде видит сообщение, что ему в календарь добавлено напоминание.
- **Цель:** Продемонстрировать, как платформа может стать **проактивным помощником**, а не просто инструментом для учёта. Это повышает ценность продукта и лояльность пользователей, открывая двери для новых "умных" функций (напоминания о продлении подписок, предсказание крупных трат и т.д.).

### Улучшение UX: Повышение убедительности рекомендаций
- **Что это:** Улучшен контент, генерируемый `advice-service` для рекомендации по страхованию дохода.
- **Как это работает:** Вместо простого предложения "подумать о страховании" теперь используется более убедительная формула "Проблема -> Усиление -> Решение". Текст кратко объясняет пользователю, *почему* ему нужна эта услуга (отсутствие больничного) и какую *ценность* она несёт (финансовая безопасность и спокойствие).
- **Цель:** Увеличить конверсию в "лиды" для партнёров, делая предложения более релевантными и понятными для пользователя. Это является важным шагом в развитии продукта не только технологически, но и с точки зрения маркетинга и продаж.

### 6. Внедрение семантического поиска по документам (Backend)
- **Что это:** Начата реализация функции поиска по документам на естественном языке. Это позволит пользователям задавать вопросы вроде "покажи все чеки из Tesco" вместо поиска по ключевым словам.
- **Технология:**
    - В стек добавлен **Weaviate** — современная векторная база данных.
    - Создан новый микросервис `qna-service`, который отвечает за AI-логику.
    - `qna-service` использует модель `sentence-transformers` для преобразования текста документов и вопросов пользователя в числовые векторы (эмбеддинги).
    - Сервис предоставляет два эндпоинта: `/index` (для сохранения вектора документа) и `/search` (для поиска семантически близких документов).
- **Цель:** Заложить технологический фундамент для одной из самых впечатляющих "wow"-функций. Это превращает наше приложение из простого хранилища документов в интерактивную базу знаний, доступную для анализа на естественном языке.

### 7. Интеграция индексации в конвейер обработки документов
- **Что это:** Настроен сквозной процесс индексации.
- **Как это работает:**
    1. Celery-воркер сервиса `documents-service` после завершения имитации OCR не просто сохраняет результат в PostgreSQL, а выполняет следующий шаг.
    2. Он формирует текстовое описание документа (например, "Чек от Tesco на сумму...") и отправляет его вместе с ID пользователя и документа в `qna-service`.
    3. `qna-service` получает эти данные, генерирует вектор и сохраняет его в Weaviate.
- **Цель:** "Оживить" бэкенд семантического поиска. Теперь каждый новый документ, загруженный пользователем, автоматически проходит весь путь от сохранения в S3 до индексации в векторной базе данных, становясь доступным для "умного" поиска.

### 8. Реализация UI для семантического поиска
- **Что это:** На странице `/documents` добавлен новый интерактивный компонент.
- **Как это работает:**
    1. Пользователь вводит вопрос на естественном языке в поисковую строку.
    2. Фронтенд отправляет этот вопрос в `qna-service`.
    3. `qna-service` преобразует вопрос в вектор и находит в базе **Weaviate** наиболее близкие по смыслу документы, принадлежащие этому пользователю.
    4. Список найденных документов и релевантные фрагменты текста отображаются пользователю.
- **Цель:** Завершить полный цикл реализации функции семантического поиска. Это превращает приложение в интерактивную базу знаний и является мощным конкурентным преимуществом.

### Финальный штрих: Пользовательский аудит-контроль

- **Что это:** Создана новая страница `/activity`, на которой пользователь может видеть полную историю всех важных событий, связанных с его аккаунтом.
- **Как это работает:**
    1. Фронтенд обращается к `compliance-service` за списком всех аудиторских событий, связанных с ID текущего пользователя.
    2. Технические названия действий (например, `partner.handoff.initiated`) преобразуются в понятные для человека описания.
- **Цель:** Повысить доверие и прозрачность для пользователя. Эта функция превращает `compliance-service` из внутреннего инструмента компании в полезную для клиента фичу, которая даёт ему полный контроль и понимание того, что происходит с его данными. Это является важным шагом для соответствия требованиям GDPR и построения доверительных отношений.
- **Что это:** Простой блок с советом по страхованию на дашборде был превращён в полноценный интерактивный "Call-to-Action" виджет.
- **Как это работает:**
    1. Компонент на фронтенде теперь делает два запроса: один в `advice-service` за текстом рекомендации, а второй — в `partner-registry` за списком партнёров, предоставляющих нужную услугу (в данном случае, "income_protection").
    2. В интерфейсе отображается карточка, где слева объясняется **проблема** (риск потери дохода), а справа предлагается **решение** (список проверенных партнёров с кнопкой "Request a Quote").
    3. Нажатие на кнопку запускает уже реализованный механизм "передачи" пользователя партнёру с записью в аудиторский журнал.
- **Цель:** Реализовать полный цикл монетизации по модели Marketplace (Pay-Per-Lead). Мы не просто даём совет, а сразу же предлагаем пользователю решение и обеспечиваем его "бесшовный" переход к партнёру.
- **Что это:** Реализована функция генерации персональных советов по страхованию дохода.
- **Как это работает:**
    1. `advice-service` был модернизирован. Теперь он умеет обращаться к `transactions-service` для анализа доходов пользователя.
    2. На основе расчёта среднего месячного дохода сервис генерирует динамический совет, предлагая пользователю задуматься о страховании дохода.
    3. На главной странице дашборда появился новый информационный блок, который отображает этот совет.
- **Цель:** Продемонстрировать, как платформа может быть использована для cross-sell и up-sell релевантных финансовых продуктов, создавая ценность для пользователя и открывая ещё один канал монетизации через партнёрскую программу.