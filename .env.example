# --- Core database ---
POSTGRES_USER=user
POSTGRES_PASSWORD=change_me_in_real_envs
POSTGRES_DB=db_user_profile

# --- Auth ---
AUTH_SECRET_KEY=replace_with_a_long_random_secret

# --- Service database URLs ---
USER_PROFILE_DATABASE_URL=postgresql+asyncpg://user:password@postgres/db_user_profile
TRANSACTIONS_DATABASE_URL=postgresql+asyncpg://user:password@postgres/db_transactions
COMPLIANCE_DATABASE_URL=postgresql+asyncpg://user:password@postgres/db_compliance
DOCUMENTS_DATABASE_URL=postgresql+asyncpg://user:password@postgres/db_documents
CONSENT_DATABASE_URL=postgresql+asyncpg://user:password@postgres/db_consent
PARTNER_DATABASE_URL=postgresql+asyncpg://user:password@postgres/db_partner
PARTNER_AUTO_CREATE_SCHEMA=true
PARTNER_BILLING_REPORT_ALLOWED_SCOPES=billing:read
PARTNER_BILLING_REPORT_ALLOWED_ROLES=admin,billing_admin
PARTNER_BILLING_REPORT_ALLOWED_USERS=
PARTNER_BILLING_INVOICE_DUE_DAYS=14
PMF_GATE_REQUIRED_ACTIVATION_RATE_PERCENT=60
PMF_GATE_REQUIRED_RETENTION_90D_PERCENT=75
PMF_GATE_REQUIRED_NPS_SCORE=45
PMF_GATE_MIN_ELIGIBLE_USERS_90D=20
PMF_GATE_MIN_NPS_RESPONSES=20
SEED_GATE_REQUIRED_MRR_GBP=40000
SEED_GATE_MAX_MONTHLY_CHURN_PERCENT=3
SEED_GATE_MIN_LTV_CAC_RATIO=4

# --- Internal service URLs ---
CATEGORIZATION_SERVICE_URL=http://categorization-service/categorize
CONSENT_COMPLIANCE_SERVICE_URL=http://compliance-service/audit-events
PARTNER_COMPLIANCE_SERVICE_URL=http://compliance-service/audit-events
BANKING_TRANSACTIONS_SERVICE_URL=http://transactions-service/import
DOCUMENTS_QNA_SERVICE_URL=http://qna-service/index
QNA_WEAVIATE_URL=http://weaviate:8080
ADVICE_TRANSACTIONS_SERVICE_URL=http://transactions-service/transactions/me
ANALYTICS_TRANSACTIONS_SERVICE_URL=http://transactions-service/transactions/me
ANALYTICS_DOCUMENTS_SERVICE_URL=http://documents-service/documents
ANALYTICS_USER_PROFILE_SERVICE_URL=http://user-profile-service/profiles/me
AGENT_DOCUMENTS_REVIEW_QUEUE_URL=http://documents-service/documents/review-queue
AGENT_DOCUMENTS_REVIEW_UPDATE_URL_TEMPLATE=http://documents-service/documents/{document_id}/review
AGENT_TRANSACTIONS_RECEIPT_DRAFTS_URL=http://transactions-service/transactions/receipt-drafts/unmatched
AGENT_TRANSACTIONS_RECONCILE_URL_TEMPLATE=http://transactions-service/transactions/receipt-drafts/{draft_transaction_id}/reconcile
AGENT_TRANSACTIONS_IGNORE_URL_TEMPLATE=http://transactions-service/transactions/receipt-drafts/{draft_transaction_id}/ignore
AGENT_TRANSACTIONS_ME_URL=http://transactions-service/transactions/me
AGENT_TAX_ENGINE_CALCULATE_URL=http://tax-engine/calculate
AGENT_TAX_ENGINE_CALCULATE_AND_SUBMIT_URL=http://tax-engine/calculate-and-submit
AGENT_DEFAULT_TAX_LOOKBACK_DAYS=365
AGENT_REDIS_URL=redis://redis:6379/0
AGENT_SESSION_TTL_SECONDS=86400
AGENT_CONFIRMATION_TOKEN_TTL_SECONDS=900
AGENT_AUDIT_MAX_EVENTS=500
AGENT_AUDIT_TTL_SECONDS=604800
AGENT_UNTRUSTED_TEXT_MAX_LENGTH=300
AGENT_WRITE_ACTIONS_ENABLED=true
NEXT_PUBLIC_AGENT_SERVICE_URL=http://localhost:8000/api/agent
NEXT_PUBLIC_PARTNER_REGISTRY_URL=http://localhost:8009
TAX_TRANSACTIONS_SERVICE_URL=http://transactions-service/transactions/me
TAX_INTEGRATIONS_SERVICE_URL=http://integrations-service/integrations/hmrc/submit-tax-return
TAX_MTD_QUARTERLY_INTEGRATIONS_SERVICE_URL=http://integrations-service/integrations/hmrc/mtd/quarterly-update
TAX_CALENDAR_SERVICE_URL=http://calendar-service/events
TAX_MTD_ITSA_RULES_JSON=[{"policy_code":"UK_MTD_ITSA_2026","effective_from":"2026-04-06","threshold":50000,"reporting_cadence":"quarterly_updates_plus_final_declaration"},{"policy_code":"UK_MTD_ITSA_2027","effective_from":"2027-04-06","threshold":30000,"reporting_cadence":"quarterly_updates_plus_final_declaration"},{"policy_code":"UK_MTD_ITSA_2028","effective_from":"2028-04-06","threshold":20000,"reporting_cadence":"quarterly_updates_plus_final_declaration"}]
HMRC_DIRECT_API_BASE_URL=https://api.service.hmrc.gov.uk
HMRC_DIRECT_SUBMISSION_ENABLED=false
HMRC_OAUTH_TOKEN_URL=https://test-api.service.hmrc.gov.uk/oauth/token
HMRC_OAUTH_CLIENT_ID=
HMRC_OAUTH_CLIENT_SECRET=
HMRC_OAUTH_SCOPE=write:self-assessment
HMRC_QUARTERLY_ENDPOINT_PATH=/itsa/quarterly-updates
HMRC_REQUEST_TIMEOUT_SECONDS=20
HMRC_DIRECT_FALLBACK_TO_SIMULATION=false
HMRC_OAUTH_CREDENTIALS_ROTATED_AT=
HMRC_OAUTH_ROTATION_MAX_AGE_DAYS=90
HMRC_SLO_WINDOW_SIZE=200
HMRC_SLO_SUCCESS_RATE_TARGET_PERCENT=99
HMRC_SLO_P95_LATENCY_TARGET_MS=2500
TAX_OTEL_SERVICE_NAME=tax-engine
TAX_OTEL_EXPORTER_OTLP_ENDPOINT=http://jaeger:4317
LOCALIZATION_CATALOG_DIR=/code/catalogs

# --- Vault (dev mode defaults) ---
BANKING_VAULT_ADDR=http://vault:8200
BANKING_VAULT_TOKEN=dev-root-token
VAULT_DEV_ROOT_TOKEN_ID=dev-root-token
VAULT_DEV_LISTEN_ADDRESS=0.0.0.0:8200

# --- Celery ---
CELERY_BROKER_URL=redis://redis:6379/0
CELERY_RESULT_BACKEND=redis://redis:6379/0

# --- Documents and LocalStack ---
DOCUMENTS_AWS_ENDPOINT_URL=http://localstack:4566
DOCUMENTS_AWS_ACCESS_KEY_ID=test
DOCUMENTS_AWS_SECRET_ACCESS_KEY=test
DOCUMENTS_AWS_DEFAULT_REGION=eu-west-2
DOCUMENTS_AWS_TEXTRACT_ENDPOINT_URL=http://localstack:4566
DOCUMENTS_S3_BUCKET_NAME=documents-bucket
LOCALSTACK_SERVICES=s3
DOCUMENTS_CATEGORIZATION_SERVICE_URL=http://categorization-service/categorize
DOCUMENTS_TRANSACTIONS_SERVICE_URL=http://transactions-service/transactions/receipt-drafts
DOCUMENTS_OCR_PROVIDER=textract
DOCUMENTS_OCR_REVIEW_CONFIDENCE_THRESHOLD=0.75
