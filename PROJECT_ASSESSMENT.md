# Независимая оценка проекта: FinTech Platform

**Дата проведения:** 2026-02-12  
**Общий объём кодовой базы:** ~9750 строк (Python, TypeScript, YAML, Terraform, CSS, JSON)

---

## 1. Общая оценка

| Категория                     | Оценка   | Комментарий                                              |
|-------------------------------|----------|----------------------------------------------------------|
| **Архитектура**               | 8 / 10   | Грамотная микросервисная архитектура с чётким разделением |
| **Качество кода (Backend)**   | 6 / 10   | Хорошая структура, но много заглушек и дублирования      |
| **Качество кода (Frontend)**  | 4 / 10   | Критические баги: дублированный код в файлах             |
| **Тестирование**              | 5 / 10   | Юнит-тесты есть, но CI не запускает их; покрытие низкое  |
| **Безопасность**              | 5 / 10   | Хорошая задумка, но fake_auth_check повсюду              |
| **Инфраструктура / DevOps**   | 7 / 10   | Docker Compose, Nginx, Observability — всё на месте      |
| **Документация**              | 7 / 10   | Хорошая документация, но с дублированием контента        |
| **Готовность к продакшену**   | 3 / 10   | Прототип, не готовый к промышленной эксплуатации          |

**Итоговая оценка: 5.6 / 10** — Качественный архитектурный прототип, демонстрирующий широкий набор технологий. Не является production-ready системой.

---

## 2. Сильные стороны проекта

### 2.1 Архитектурная зрелость
- **16 микросервисов** с чётко определёнными зонами ответственности (Single Responsibility Principle).
- **API Gateway (Nginx)** как единая точка входа с правильной маршрутизацией.
- **Polyglot Persistence**: PostgreSQL (реляционные данные), Redis (брокер задач), Weaviate (векторный поиск), S3 (файлы), Vault (секреты) — каждое хранилище под свою задачу.
- **Асинхронная обработка** через Celery + Redis для тяжёлых операций (OCR, импорт транзакций).

### 2.2 Полный стек Observability
- **Метрики:** Prometheus + Grafana с преднастроенными datasources.
- **Логи:** Loki + Promtail для централизованного сбора логов из контейнеров.
- **Трассировка:** Jaeger + OpenTelemetry с инструментацией FastAPI и httpx.
- Это полноценная реализация "трёх столпов наблюдаемости" — большая редкость даже для production-проектов.

### 2.3 Безопасность на уровне архитектуры
- **HashiCorp Vault** для хранения банковских токенов — правильный паттерн для FinTech.
- **bcrypt** для хэширования паролей.
- **JWT с конфигурируемым секретом** через переменные окружения.
- **Compliance Service** с append-only аудит-логом.
- **2FA (TOTP)** с генерацией QR-кодов.

### 2.4 Продуманная бизнес-логика
- Сквозной сценарий: подключение банка -> импорт -> ML-категоризация -> налоговый расчёт.
- Семантический поиск по документам (sentence-transformers + Weaviate).
- PDF-генерация для ипотечных отчётов.
- Прогнозирование cash flow с визуализацией (recharts).
- Партнёрский marketplace с аудитом handoff.

### 2.5 Инфраструктура
- Docker Compose с 25+ сервисами, включая инфраструктурные.
- Alembic миграции для сервисов с PostgreSQL.
- Terraform-конфигурация (базовая).
- GitHub Actions CI pipeline (хоть и неполный).

---

## 3. Критические проблемы

### 3.1 КРИТИЧНО: Дублированный код в файлах фронтенда

Несколько ключевых файлов фронтенда содержат **дублированный контент** — одни и те же блоки кода вставлены дважды:

- **`pages/_app.tsx`** (150 строк): Компоненты `AppContent` и `MyApp` определены дважды. Файл содержит два `export default MyApp`. Это **не скомпилируется**.
- **`pages/index.tsx`** (~806 строк): Компоненты `UserProfile`, `BankConnection`, `TransactionsList`, `TaxCalculator`, `DocumentsManager`, `HomePage` — все продублированы. Множественные `export default`.
- **`pages/dashboard.tsx`** (~298 строк): `TaxCalculator`, `CashFlowChart`, `ActionCenter`, `DashboardPage` — всё продублировано.
- **`docs/security/security_overview_2025-10-04.md`**: Весь контент документа дублирован.

**Вердикт:** Фронтенд в текущем состоянии не скомпилируется и не запустится.

### 3.2 КРИТИЧНО: Фиктивная аутентификация во всех сервисах

Каждый микросервис (кроме auth-service) использует заглушку:

```python
def fake_auth_check() -> str:
    return "fake-user-123"
```

Это означает:
- **Любой запрос считается аутентифицированным** — нет проверки JWT-токена.
- **Все запросы принадлежат одному пользователю** — нет мультитенантности.
- В production это означает полное отсутствие контроля доступа.

При этом в `PROJECT_DOSSIER.md` утверждается: "Полный цикл аутентификации: Регистрация, вход, деактивация, администрирование." — это верно только для auth-service. Остальные 15 сервисов не валидируют токены.

### 3.3 КРИТИЧНО: CI pipeline не запускает тесты

В файле `.github/workflows/ci.yaml` (строка 49):
```yaml
echo "Pytest would run here if 'tests/' directory existed."
# pytest
```

Команда `pytest` закомментирована. CI pipeline фактически **не запускает тесты**, хотя тесты для некоторых сервисов существуют.

### 3.4 Тест auth-service содержит ошибки

В `services/auth-service/tests/test_main.py`:
- `test_register_user_success` (строка 25): проверяет `assert "id" in data`, но модель `User` не содержит поле `id`. Тест упадёт.
- `test_register_user_already_exists` (строка 39): отправляет JSON вместо `form-data`, а эндпоинт ожидает `OAuth2PasswordRequestForm`.
- `test_deactivate_user` (строка 109): Регистрирует "admin@example.com" через `/register`, но без флага `is_admin=True`. Деактивация завершится с 403.

### 3.5 Нет версионирования зависимостей

В `requirements.txt` файлах зависимости указаны без версий:
```
fastapi
uvicorn[standard]
pydantic[email]
```

Это означает, что при `pip install` будет установлена последняя версия, что может привести к **непредсказуемому поведению** при пересборке контейнеров в разное время. Должно быть:
```
fastapi==0.109.0
uvicorn[standard]==0.27.0
```

---

## 4. Существенные замечания

### 4.1 In-memory "базы данных" для половины сервисов

Из 16 сервисов только 4 используют реальную базу данных (PostgreSQL):
- `user-profile-service`
- `transactions-service`
- `documents-service`
- `compliance-service`

Остальные 12 сервисов используют Python-словари (`dict`) или вообще не хранят состояние. При перезапуске контейнера все данные теряются.

### 4.2 Одна общая БД PostgreSQL без изоляции

Все 4 сервиса, использующие PostgreSQL, подключены к **одному** экземпляру PostgreSQL. Изоляция на уровне разных баз данных (`db_user_profile`, `db_transactions`, `db_documents`, `db_compliance`) — это хорошо, но инициализация баз через скрипт `infra/postgres/init-db.sh` создаёт связанность.

### 4.3 Использование Float для денежных сумм

В `services/transactions-service/app/models.py`:
```python
amount = Column(Float, nullable=False)
```

Для финансового приложения **использование Float для денежных сумм** — грубая ошибка. Из-за особенностей представления чисел с плавающей точкой, `0.1 + 0.2 ≠ 0.3`. Необходимо использовать `Numeric(precision=19, scale=4)` или `Decimal`.

### 4.4 Pydantic v1 синтаксис (`orm_mode = True`)

В `services/transactions-service/app/schemas.py`:
```python
class Config:
    orm_mode = True
```

Это устаревший синтаксис Pydantic v1. В Pydantic v2 используется `model_config = ConfigDict(from_attributes=True)`. При установке Pydantic v2 (текущая latest) код будет выдавать deprecation warnings.

### 4.5 Метод `.dict()` вместо `.model_dump()`

В `crud.py` и `celery_app.py` используется `t.dict()` — это Pydantic v1 метод, deprecated в v2.

### 4.6 Нет Dockerfile для Nginx

В `docker-compose.yml` для nginx-gateway указано `build: ./nginx`, но в директории `/workspace/nginx/` есть только `nginx.conf`. Dockerfile отсутствует, сборка контейнера не сработает.

### 4.7 Отсутствие health checks в Docker Compose

Ни один сервис в `docker-compose.yml` не имеет `healthcheck`. Без этого `depends_on` не гарантирует, что сервис реально готов принимать запросы, а лишь что контейнер запущен. В результате могут возникать race conditions при старте.

### 4.8 `@app.on_event("startup")` — deprecated

В `qna-service` используется `@app.on_event("startup")`, который deprecated в FastAPI с версии 0.109. Нужно заменить на `lifespan` context manager.

### 4.9 Отсутствие `.env.example` и переменных для production

Секреты жёстко прописаны в `docker-compose.yml`:
```yaml
POSTGRES_USER: user
POSTGRES_PASSWORD: password
AUTH_SECRET_KEY: "a_secure_random_string_for_jwt_signing_!@#$%^"
VAULT_TOKEN: "dev-root-token"
```

Нет `.env.example` и нет документированного процесса настройки секретов для production.

---

## 5. Анализ по категориям

### 5.1 Frontend (Next.js / TypeScript)

| Аспект | Статус |
|--------|--------|
| Компилируемость | **НЕТ** — дублированный код |
| Разделение на компоненты | Слабое — все компоненты в одном файле (`index.tsx` — 806 строк) |
| Типизация | Частичная — много `any` типов |
| Состояние (state management) | Нет — только `useState` без глобального стейта (кроме i18n) |
| Error handling | Базовый — `catch (err: any)` |
| i18n | Есть — своя система через Context API + локализационный сервис |
| Мобильное приложение | **Только заглушка** — `apps/mobile/` содержит только `package.json` и `.gitkeep` |

### 5.2 Backend (Python / FastAPI)

| Аспект | Статус |
|--------|--------|
| Структура проекта | Хорошая — `app/main.py`, `models.py`, `schemas.py`, `crud.py`, `database.py` |
| ORM и миграции | Alembic + SQLAlchemy (async) для 4 сервисов |
| Валидация данных | Pydantic-модели для входных данных |
| Error handling | Базовый — HTTPException, но нет глобальных обработчиков |
| Логирование | `print()` вместо `logging` — не производственный подход |
| OpenAPI specs | Присутствуют `.yaml` файлы, но не используются в коде |
| Rate limiting | **Отсутствует** |
| CORS | **Не настроен** |
| Pagination | **Отсутствует** — все endpoints возвращают все записи |

### 5.3 Тестирование

| Тип тестов | Статус |
|------------|--------|
| Юнит-тесты (auth-service) | Есть, но с ошибками |
| Юнит-тесты (transactions-service) | Есть файл, не проверял содержимое |
| Юнит-тесты (остальные) | **Отсутствуют** для 13 из 16 сервисов |
| Контрактные тесты (Pact) | Плейсхолдер — Pact файл не генерируется |
| Интеграционные тесты | 2 теста — хороший скелет, но не запускаются в CI |
| Frontend тесты | **Полностью отсутствуют** |
| CI запуск тестов | **Закомментирован** |

### 5.4 ML

| Аспект | Статус |
|--------|--------|
| `ml/models/train.py` | **Плейсхолдер** — вся логика закомментирована |
| `categorization-service` | Rule-based — не ML |
| `qna-service` | Реальный ML — `sentence-transformers` + Weaviate |
| Эксперименты / MLflow | **Отсутствует** |

### 5.5 Инфраструктура

| Аспект | Статус |
|--------|--------|
| Docker Compose | Полноценный, 25+ сервисов |
| Terraform | Минимальный — только S3 bucket |
| Kubernetes | **Только `.gitkeep`** |
| CI/CD | GitHub Actions — базовый, тесты не запускаются |
| Мониторинг | Prometheus + Grafana + Loki + Promtail + Jaeger |
| Secrets management | Vault (в dev режиме) |

---

## 6. Рекомендации по приоритету

### P0 (Блокеры — необходимо исправить немедленно)
1. **Исправить дублированный код** во всех файлах фронтенда (`_app.tsx`, `index.tsx`, `dashboard.tsx`).
2. **Раскомментировать и починить pytest** в CI pipeline.
3. **Исправить ошибки в тестах** auth-service.
4. **Заменить `Float` на `Numeric`** для денежных полей.
5. **Добавить Dockerfile для Nginx** или перейти на `image: nginx:alpine` с volume для конфига.

### P1 (Высокий приоритет)
6. **Реализовать реальную валидацию JWT-токенов** во всех сервисах (как shared middleware/library через `libs/`).
7. **Закрепить версии зависимостей** во всех `requirements.txt`.
8. **Заменить `print()` на `logging`** с настроенными уровнями.
9. **Добавить CORS middleware** в сервисы или на уровне Nginx.
10. **Добавить health checks** в docker-compose.yml.

### P2 (Средний приоритет)
11. Мигрировать на Pydantic v2 синтаксис (`.model_dump()`, `model_config`).
12. Добавить пагинацию для list-endpoints.
13. Добавить rate limiting.
14. Разделить монолитные frontend-файлы на отдельные компоненты.
15. Добавить frontend-тесты (React Testing Library / Playwright).

### P3 (Низкий приоритет)
16. Реализовать реальный ML pipeline (вместо заглушки в `train.py`).
17. Добавить Kubernetes манифесты.
18. Расширить Terraform конфигурацию.
19. Создать `.env.example` с документацией.
20. Заменить `@app.on_event("startup")` на `lifespan`.

---

## 7. Заключение

Проект представляет собой **впечатляющий по широте охвата архитектурный прототип**. Он демонстрирует знание современного стека (FastAPI, Next.js, Celery, Weaviate, Vault, OpenTelemetry, Terraform) и понимание принципов микросервисной архитектуры.

Однако между "архитектурным прототипом" и "production-ready системой" существует значительный разрыв. Основные проблемы:

- **Фронтенд не компилируется** из-за дублированного кода.
- **Аутентификация не работает** в 15 из 16 сервисов.
- **CI не запускает тесты**, а существующие тесты содержат ошибки.
- **Финансовые расчёты ведутся с Float**, что недопустимо для FinTech.

Утверждение из `PROJECT_DOSSIER.md` о том, что проект является "полнофункциональным, готовым к промышленной эксплуатации прототипом" — **преувеличение**. Это хороший прототип для демонстрации архитектурных идей, но он требует серьёзной доработки для использования в production.

**Рекомендация:** Проект отлично подходит как учебный/демонстрационный. Для перевода в production необходимо последовательно реализовать рекомендации уровней P0 и P1, что потребует примерно 2-4 недели работы одного опытного разработчика.
