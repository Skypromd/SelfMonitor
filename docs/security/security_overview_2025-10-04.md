# Обзор системы безопасности
**Дата документа:** 2025-10-04
# Обзор системы безопасности
**Дата документа:** 2025-10-04

## 1. Философия безопасности

В основе архитектуры нашего приложения лежит принцип **"Defense in Depth" (Эшелонированная оборона)**. Безопасность обеспечивается не одним компонентом, а множеством независимых, но взаимосвязанных уровней защиты. Компрометация одного уровня не должна приводить к компрометации всей системы.

## 2. Уровни защиты

### Уровень 1: Аутентификация и авторизация

- **Технология:** Стандарт **OAuth2 с использованием JWT-токенов**.
- **Как это работает:**
    1.  **Надёжное хранение паролей:** Пароли пользователей никогда не хранятся в открытом виде. Они хэшируются с использованием криптографически стойкого алгоритма **bcrypt** (`passlib`).
    2.  **Краткоживущие токены доступа:** При входе в систему пользователь получает JWT-токен с коротким сроком жизни (например, 30 минут). Этот токен подписывается секретным ключом и используется для доступа ко всем защищённым ресурсам.
    3.  **Безопасная передача секрета:** Секретный ключ для подписи токенов не хранится в коде, а передаётся в сервис через **переменные окружения**, что является стандартом безопасности.
    4.  **Управление доступом:** Реализован прототип ролевой модели. Критически важные действия (например, деактивация пользователя) доступны только пользователю с правами администратора.

### Уровень 2: Управление секретами (Secrets Management)

- **Технология:** **HashiCorp Vault**.
- **Как это работает:**
    1.  **Изоляция самых чувствительных данных:** Секреты, полученные от третьих сторон (например, токены доступа к банковским счетам от Open Banking провайдеров), **не хранятся** в основной базе данных PostgreSQL.
    2.  **Централизованное хранилище:** Эти токены сохраняются в зашифрованном виде в специализированном, защищённом хранилище — Vault.
    3.  **Ограниченный доступ:** В основной базе данных хранится только несекретный идентификатор (`connection_id`), который служит ссылкой на секрет в Vault. Доступ к самому Vault строго ограничен.
- **Ценность:** Этот подход обеспечивает максимальную защиту для самых критичных данных. Даже в случае полной утечки основной базы данных, злоумышленники не получат ключи к финансовым данным пользователей.

### Уровень 3: Соответствие требованиям и аудит (Compliance & Audit)

- **Технология:** Выделенный `compliance-service` с базой данных PostgreSQL.
- **Как это работает:**
    1.  **Неизменяемый журнал:** Все юридически значимые действия в системе (выдача согласия на обработку данных, отзыв согласия, передача пользователя партнёру) записываются в виде событий в отдельную таблицу `audit_events`.
    2.  **Append-Only логика:** На уровне API у этого сервиса отсутствуют методы для изменения или удаления записей, что обеспечивает целостность аудиторского журнала.
    3.  **Централизация:** Все сервисы, выполняющие важные действия, отправляют события в `compliance-service`, создавая единый, полный аудиторский след для всей системы.

### Уровень 4: Защита данных

- **Шифрование при передаче (In-Transit):** Все коммуникации между клиентом и сервером, а также между сервисами (в production-среде) должны осуществляться по протоколу HTTPS/TLS.
- **Шифрование при хранении (At-Rest):**
    - **Секреты:** Обеспечивается Vault.
    - **Данные в БД:** Современные облачные провайдеры баз данных (например, AWS RDS) обеспечивают шифрование диска по умолчанию.
    - **Файлы:** AWS S3 обеспечивает шифрование загруженных файлов по умолчанию.

### Уровень 5: Сетевая и инфраструктурная безопасность

- **Контейнеризация:** Каждый сервис работает в изолированном Docker-контейнере, что ограничивает его доступ к операционной системе и другим сервисам.
- **Приватная сеть:** Все сервисы общаются друг с другом внутри приватной Docker-сети (`default_network`). Наружу "смотрят" только необходимые порты API-шлюзов или отдельных сервисов, что минимизирует поверхность атаки.

## 3. Заключение

Созданная система безопасности является многоуровневой и соответствует современным стандартам для разработки FinTech-приложений. Она закладывает прочный фундамент для прохождения будущих сертификаций (SOC2, ISO 27001) и построения долгосрочного доверия с клиентами.
## 1. Философия безопасности

В основе архитектуры нашего приложения лежит принцип **"Defense in Depth" (Эшелонированная оборона)**. Безопасность обеспечивается не одним компонентом, а множеством независимых, но взаимосвязанных уровней защиты. Компрометация одного уровня не должна приводить к компрометации всей системы.

## 2. Уровни защиты

### Уровень 1: Аутентификация и авторизация

- **Технология:** Стандарт **OAuth2 с использованием JWT-токенов**.
- **Как это работает:**
    1.  **Надёжное хранение паролей:** Пароли пользователей никогда не хранятся в открытом виде. Они хэшируются с использованием криптографически стойкого алгоритма **bcrypt** (`passlib`).
    2.  **Краткоживущие токены доступа:** При входе в систему пользователь получает JWT-токен с коротким сроком жизни (например, 30 минут). Этот токен подписывается секретным ключом и используется для доступа ко всем защищённым ресурсам.
    3.  **Безопасная передача секрета:** Секретный ключ для подписи токенов не хранится в коде, а передаётся в сервис через **переменные окружения**, что является стандартом безопасности.
    4.  **Управление доступом:** Реализован прототип ролевой модели. Критически важные действия (например, деактивация пользователя) доступны только пользователю с правами администратора.

### Уровень 2: Управление секретами (Secrets Management)

- **Технология:** **HashiCorp Vault**.
- **Как это работает:**
    1.  **Изоляция самых чувствительных данных:** Секреты, полученные от третьих сторон (например, токены доступа к банковским счетам от Open Banking провайдеров), **не хранятся** в основной базе данных PostgreSQL.
    2.  **Централизованное хранилище:** Эти токены сохраняются в зашифрованном виде в специализированном, защищённом хранилище — Vault.
    3.  **Ограниченный доступ:** В основной базе данных хранится только несекретный идентификатор (`connection_id`), который служит ссылкой на секрет в Vault. Доступ к самому Vault строго ограничен.
- **Ценность:** Этот подход обеспечивает максимальную защиту для самых критичных данных. Даже в случае полной утечки основной базы данных, злоумышленники не получат ключи к финансовым данным пользователей.

### Уровень 3: Соответствие требованиям и аудит (Compliance & Audit)

- **Технология:** Выделенный `compliance-service` с базой данных PostgreSQL.
- **Как это работает:**
    1.  **Неизменяемый журнал:** Все юридически значимые действия в системе (выдача согласия на обработку данных, отзыв согласия, передача пользователя партнёру) записываются в виде событий в отдельную таблицу `audit_events`.
    2.  **Append-Only логика:** На уровне API у этого сервиса отсутствуют методы для изменения или удаления записей, что обеспечивает целостность аудиторского журнала.
    3.  **Централизация:** Все сервисы, выполняющие важные действия, отправляют события в `compliance-service`, создавая единый, полный аудиторский след для всей системы.

### Уровень 4: Защита данных

- **Шифрование при передаче (In-Transit):** Все коммуникации между клиентом и сервером, а также между сервисами (в production-среде) должны осуществляться по протоколу HTTPS/TLS.
- **Шифрование при хранении (At-Rest):**
    - **Секреты:** Обеспечивается Vault.
    - **Данные в БД:** Современные облачные провайдеры баз данных (например, AWS RDS) обеспечивают шифрование диска по умолчанию.
    - **Файлы:** AWS S3 обеспечивает шифрование загруженных файлов по умолчанию.

### Уровень 5: Сетевая и инфраструктурная безопасность

- **Контейнеризация:** Каждый сервис работает в изолированном Docker-контейнере, что ограничивает его доступ к операционной системе и другим сервисам.
- **Приватная сеть:** Все сервисы общаются друг с другом внутри приватной Docker-сети (`default_network`). Наружу "смотрят" только необходимые порты API-шлюзов или отдельных сервисов, что минимизирует поверхность атаки.

## 3. Заключение

Созданная система безопасности является многоуровневой и соответствует современным стандартам для разработки FinTech-приложений. Она закладывает прочный фундамент для прохождения будущих сертификаций (SOC2, ISO 27001) и построения долгосрочного доверия с клиентами.
