apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# SelfMonitor Platform - Development Environment Configuration
# This overlay customizes the base configuration for development deployment

metadata:
  name: selfmonitor-development
  annotations:
    version: "2.0.0"
    environment: "development"
    description: "Development deployment configuration for SelfMonitor FinTech Platform"

# Base configuration
resources:
- ../../base

# Namespace for development
namespace: selfmonitor-dev

# Development labels
commonLabels:
  environment: development
  deployment-tier: development

# Development-specific patches
patches:
# Reduce replicas for development
- target:
    kind: Deployment
    name: nginx-deployment
  patch: |-
    - op: replace
      path: /spec/replicas
      value: 1

- target:
    kind: Deployment
    name: auth-service-deployment
  patch: |-
    - op: replace
      path: /spec/replicas
      value: 1

- target:
    kind: Deployment
    name: ai-agent-service-deployment
  patch: |-
    - op: replace
      path: /spec/replicas
      value: 1

- target:
    kind: Deployment
    name: user-profile-service-deployment
  patch: |-
    - op: replace
      path: /spec/replicas
      value: 1

# Reduce resource requirements for development
- target:
    kind: Deployment
    name: postgres-deployment
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources
      value:
        requests:
          memory: "512Mi"
          cpu: "250m"
        limits:
          memory: "2Gi"
          cpu: "1000m"

- target:
    kind: Deployment
    name: redis-deployment
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources
      value:
        requests:
          memory: "128Mi"
          cpu: "100m"
        limits:
          memory: "512Mi"
          cpu: "250m"

- target:
    kind: Deployment
    name: ai-agent-service-deployment
  patch: |-
    - op: replace
      path: /spec/template/spec/containers/0/resources
      value:
        requests:
          memory: "512Mi"
          cpu: "250m"
        limits:
          memory: "2Gi"
          cpu: "1000m"

# Smaller storage for development
- target:
    kind: PersistentVolumeClaim
    name: postgres-pvc
  patch: |-
    - op: replace
      path: /spec/resources/requests/storage
      value: 10Gi

- target:
    kind: PersistentVolumeClaim
    name: redis-pvc
  patch: |-
    - op: replace
      path: /spec/resources/requests/storage
      value: 2Gi

# Development secrets (non-production values)
secretGenerator:
- name: postgres-secret
  behavior: replace
  literals:
  - POSTGRES_USER=selfmonitor_dev
  - POSTGRES_PASSWORD=dev_password_123
  - POSTGRES_DB=selfmonitor_development

- name: auth-secret
  behavior: replace
  literals:
  - AUTH_SECRET_KEY=dev_auth_secret_key_12345
  - JWT_SECRET_KEY=dev_jwt_secret_key_67890

- name: openai-secret
  behavior: replace
  literals:
  - OPENAI_API_KEY=sk-fake-key-for-development

- name: banking-secret
  behavior: replace
  literals:
  - VAULT_ADDR=http://vault-dev:8200
  - VAULT_TOKEN=dev_vault_token
  - BANKING_API_KEY=dev_banking_api_key

- name: redis-secret
  behavior: replace
  literals:
  - REDIS_PASSWORD=dev_redis_password

- name: service-secret
  behavior: replace
  literals:
  - API_KEY=dev_service_api_key

# Development ConfigMaps
configMapGenerator:
- name: app-config
  behavior: replace
  literals:
  - ENVIRONMENT=development
  - LOG_LEVEL=DEBUG
  - REDIS_HOST=redis-service
  - REDIS_PORT="6379"
  - POSTGRES_HOST=postgres-service
  - POSTGRES_PORT="5432"
  - NGINX_PORT="80"
  - METRICS_PORT="9090"
  - HEALTH_CHECK_INTERVAL=60s
  - SESSION_TIMEOUT=3600
  - MAX_CONNECTIONS=50
  - CORS_ORIGINS=http://localhost:3000,http://localhost:8000,http://localhost:8010
  - SSL_VERIFY=false
  - RATE_LIMITING=false
  - SECURITY_HEADERS=false

# Development image tags (latest versions)
images:
- name: selfmonitor/auth-service
  newTag: "latest"
- name: selfmonitor/user-profile-service
  newTag: "latest"
- name: selfmonitor/ai-agent-service
  newTag: "latest"
- name: postgres
  newTag: "15-alpine"
- name: redis
  newTag: "7-alpine"
- name: nginx
  newTag: "1.25-alpine"

# Development replicas (single instance for most services)
replicas:
- name: nginx-deployment
  count: 1
- name: auth-service-deployment
  count: 1
- name: ai-agent-service-deployment
  count: 1
- name: user-profile-service-deployment
  count: 1
- name: postgres-deployment
  count: 1
- name: redis-deployment
  count: 1